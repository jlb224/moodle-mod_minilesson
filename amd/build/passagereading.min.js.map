{"version":3,"file":"passagereading.min.js","sources":["../src/passagereading.js"],"sourcesContent":["define(['jquery', 'core/log', 'mod_minilesson/definitions','mod_minilesson/cloudpoodllloader',\n    'mod_minilesson/ttrecorder',],\n    function($, log, def,cloudpoodll, ttrecorder) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the Passage Reading item type\n   */\n\n  log.debug('MiniLesson Passage Reading: initialising');\n\n  var app= {\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function(index, itemdata, quizhelper) {\n      this.itemdata = itemdata;\n      this.quizhelper = quizhelper;\n      this.init_components(quizhelper,itemdata);\n      this.register_events(index, itemdata, quizhelper);\n\n    },\n    next_question: function(percent) {\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = 1;\n      stepdata.correctitems = percent>0?1:0;\n      stepdata.grade = percent;\n      this.quizhelper.do_next(stepdata);\n    },\n\n    register_events: function(index, itemdata, quizhelper) {\n      var self = this;\n      var nextbutton = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\");\n      \n      nextbutton.on('click', function(e) {\n        self.next_question(0);\n      });\n\n    },\n\n    init_components: function(quizhelper,itemdata){\n          var self=this;\n          var theCallback = function(message) {\n\n            switch (message.type) {\n              case 'recording':\n\n                break;\n\n              case 'speech':\n                log.debug(\"speech at speechcards\");\n                var speechtext = message.capturedspeech;\n                var spoken_clean  = quizhelper.cleanText(speechtext);\n               // var correct_clean = app.quizhelper.cleanText(app.terms[app.pointer - 1]);\n               // var correctphonetic = app.phonetics[app.pointer - 1];\n                log.debug('speechtext:',speechtext);\n                log.debug('spoken:',spoken_clean);\n               // log.debug('correct:',correct_clean);\n    \n            } //end of switch message type\n          };\n\n\n\n        if(quizhelper.use_ttrecorder()) {\n            //init tt recorder\n            var opts = {};\n            opts.uniqueid = itemdata.uniqueid;\n            opts.callback = theCallback;\n            opts.stt_guided=quizhelper.is_stt_guided();\n            self.ttrec = ttrecorder.clone();\n            self.ttrec.init(opts);\n            //init prompt for first card\n            //in some cases ttrecorder wants to know the target\n            //app.ttrec.currentPrompt=app.displayterms[app.pointer - 1];\n\n        }else{\n            //init cloudpoodll push recorder\n            cloudpoodll.init('minilesson-recorder-passagereading-' + itemdata.id, theCallback);\n        }\n\n\n    }//end of init components\n\n  };//end of return objects\n  return app;\n});"],"names":["define","$","log","def","cloudpoodll","ttrecorder","debug","clone","extend","this","init","index","itemdata","quizhelper","init_components","register_events","next_question","percent","stepdata","self","hasgrade","totalitems","correctitems","grade","do_next","uniqueid","on","e","theCallback","message","type","speechtext","capturedspeech","spoken_clean","cleanText","use_ttrecorder","opts","callback","stt_guided","is_stt_guided","ttrec","id"],"mappings":"AAAAA,uCAAO,CAAC,SAAU,WAAY,6BAA6B,mCACvD,8BACA,SAASC,EAAGC,IAAKC,IAAIC,YAAaC,mBAOpCH,IAAII,MAAM,4CAED,CAGLC,MAAO,kBACIN,EAAEO,QAAO,EAAM,GAAIC,OAGhCC,KAAM,SAASC,MAAOC,SAAUC,iBACzBD,SAAWA,cACXC,WAAaA,gBACbC,gBAAgBD,WAAWD,eAC3BG,gBAAgBJ,MAAOC,SAAUC,aAGxCG,cAAe,SAASC,aAClBC,SAAW,GACfA,SAASP,MAAQQ,KAAKR,MACtBO,SAASE,UAAW,EACpBF,SAASG,WAAa,EACtBH,SAASI,aAAeL,QAAQ,EAAE,EAAE,EACpCC,SAASK,MAAQN,aACZJ,WAAWW,QAAQN,WAG1BH,gBAAiB,SAASJ,MAAOC,SAAUC,gBACrCM,KAAOV,KACMR,EAAE,IAAMW,SAASa,SAAW,qCAElCC,GAAG,SAAS,SAASC,GAC9BR,KAAKH,cAAc,OAKvBF,gBAAiB,SAASD,WAAWD,cAE3BgB,YAAc,SAASC,gBAEjBA,QAAQC,UACT,sBAIA,SACH5B,IAAII,MAAM,6BACNyB,WAAaF,QAAQG,eACrBC,aAAgBpB,WAAWqB,UAAUH,YAGzC7B,IAAII,MAAM,cAAcyB,YACxB7B,IAAII,MAAM,UAAU2B,mBAQzBpB,WAAWsB,iBAAkB,KAExBC,KAAO,GACXA,KAAKX,SAAWb,SAASa,SACzBW,KAAKC,SAAWT,YAChBQ,KAAKE,WAAWzB,WAAW0B,gBA5BpB9B,KA6BF+B,MAAQnC,WAAWE,QA7BjBE,KA8BF+B,MAAM9B,KAAK0B,WAOhBhC,YAAYM,KAAK,sCAAwCE,SAAS6B,GAAIb"}