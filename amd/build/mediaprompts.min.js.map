{"version":3,"file":"mediaprompts.min.js","sources":["../src/mediaprompts.js"],"sourcesContent":["define(['jquery','core/log','core/notification','core/str'], function($,log,notification,str) {\n    \"use strict\"; // jshint ;_;\n\n/*\nThis file contains functions for media prompts on the mform\n */\n\n    log.debug('MiniLesson mediaprompts: initialising');\n\n    return{\n\n        controls:{},\n        strings: {},\n\n        //init the media prompts\n        init: function(opts){\n            var that = this;\n            this.init_strings();\n            this.init_controls();\n            this.register_events();\n\n            //init the visibility of the fieldsets\n            $.each(opts, function(key, value){\n                log.debug('key: '+key+' value: '+value);\n                if(value===1){\n                    var thefieldset=$('#ml_mediaprompt_panel_'+key);\n                    thefieldset.show();\n                    //disable the option in the dropdown\n                    that.controls.select.find('option[value=\"' + key + '\"]').prop('disabled', true);\n                }\n            });\n\n            //unselect the media prompts thingy\n            that.controls.select.find('option[value=\"0\"]').prop('disabled', true);\n            that.controls.select.prop('selectedIndex',0);\n            \n\n        },\n\n         // Set up strings\n        init_strings: function(){\n            var that = this;  \n            str.get_strings([\n                { \"key\": \"reallydeletemediaprompt\", \"component\": 'mod_minilesson' },\n                { \"key\": \"deletemediaprompt\", \"component\": 'mod_minilesson' },\n                { \"key\": \"delete\", \"component\": 'core' },\n            ]).done(function (s) {\n                var i = 0;\n                that.strings.reallydeletemediaprompt = s[i++];\n                that.strings.deletemediaprompt = s[i++];\n                that.strings.delete = s[i++];\n            });\n        },\n\n        //get handles on all the page elements we will refer to\n        init_controls: function(){\n            //the media prompt select dropdown\n            this.controls.select = $('#id_mediaprompts');\n        },\n\n        //register events on select and fieldsets etc\n        register_events: function(){\n            var that=this;\n\n            //on select change add the fieldset\n            this.controls.select.on('change',function(){\n                var mediaprompt = $(this).val();\n                var thefieldset = $('#ml_mediaprompt_panel_' + mediaprompt);\n                thefieldset.show();\n                //disable the option in the dropdown\n                that.controls.select.find('option[value=\"' + mediaprompt + '\"]').prop('disabled', true);\n                //deselect all options\n                that.controls.select.prop('selectedIndex',0);\n                \n            });\n\n            //close the fieldset on button click\n            var fieldset_close = $('.ml_mediaprompt_panel button.close');\n            fieldset_close.on('click',function(){\n                var thefieldset = $(this).closest('fieldset');\n                var keyfieldname = thefieldset.data('keyfield');\n                var mediaprompt = thefieldset.data('mediaprompt');\n                console.log('keyfieldname:' + keyfieldname);\n                //fetch the input of name keyfield nested under thefieldset\n                switch (keyfieldname) {\n                    case 'itemttsdialog':\n                    case 'itemttspassage':\n                        var keyfield = thefieldset.find(\"textarea[name='\"+keyfieldname +\"']\");\n                        break;\n                    default:\n                        var keyfield = thefieldset.find(\"input[name='\"+keyfieldname +\"']\");\n                }\n                \n                //fetch the legend text\n                var legend = thefieldset.find(\"legend\").text();\n\n                //function to delete the fieldset .. we may seek confirmation first, or not, depending on if the keyfield has data\n                var dodelete=function(){\n                    //clear the data\n                    if(keyfield){\n                        keyfield.val('');\n                    }\n                    //hide the fieldset\n                    thefieldset.hide();\n                    //re-enable the select option\n                    var mediaprompt = thefieldset.data('mediaprompt');\n                    that.controls.select.find('option[value=\"' + mediaprompt + '\"]').prop('disabled', false);\n                }\n                //if we have data confirm deletion, then delete\n                log.debug('keyfield val: '+keyfield.val());\n                if(keyfield.length>0 && keyfield.val()!=''){\n                    notification.confirm(that.strings.deletemediaprompt, that.strings.reallydeletemediaprompt + legend + '?',that.strings.delete,'',dodelete);\n                }else{\n                    dodelete();\n                }\n            });\n        }\n\n    };//end of return value\n});"],"names":["define","$","log","notification","str","debug","controls","strings","init","opts","that","this","init_strings","init_controls","register_events","each","key","value","show","select","find","prop","get_strings","done","s","i","reallydeletemediaprompt","deletemediaprompt","delete","on","mediaprompt","val","thefieldset","closest","keyfieldname","data","console","keyfield","legend","text","dodelete","hide","length","confirm"],"mappings":"AAAAA,qCAAO,CAAC,SAAS,WAAW,oBAAoB,aAAa,SAASC,EAAEC,IAAIC,aAAaC,YAOrFF,IAAIG,MAAM,yCAEJ,CAEFC,SAAS,GACTC,QAAS,GAGTC,KAAM,SAASC,UACPC,KAAOC,UACNC,oBACAC,qBACAC,kBAGLb,EAAEc,KAAKN,MAAM,SAASO,IAAKC,QACvBf,IAAIG,MAAM,QAAQW,IAAI,WAAWC,OACtB,IAARA,SACiBhB,EAAE,yBAAyBe,KAC/BE,OAEZR,KAAKJ,SAASa,OAAOC,KAAK,iBAAmBJ,IAAM,MAAMK,KAAK,YAAY,OAKlFX,KAAKJ,SAASa,OAAOC,KAAK,qBAAqBC,KAAK,YAAY,GAChEX,KAAKJ,SAASa,OAAOE,KAAK,gBAAgB,IAM9CT,aAAc,eACNF,KAAOC,KACXP,IAAIkB,YAAY,CACZ,KAAS,oCAAwC,kBACjD,KAAS,8BAAkC,kBAC3C,KAAS,mBAAuB,UACjCC,MAAK,SAAUC,OACVC,EAAI,EACRf,KAAKH,QAAQmB,wBAA0BF,EAAEC,KACzCf,KAAKH,QAAQoB,kBAAoBH,EAAEC,KACnCf,KAAKH,QAAQqB,OAASJ,EAAEC,SAKhCZ,cAAe,gBAENP,SAASa,OAASlB,EAAE,qBAI7Ba,gBAAiB,eACTJ,KAAKC,UAGJL,SAASa,OAAOU,GAAG,UAAS,eACzBC,YAAc7B,EAAEU,MAAMoB,MACR9B,EAAE,yBAA2B6B,aACnCZ,OAEZR,KAAKJ,SAASa,OAAOC,KAAK,iBAAmBU,YAAc,MAAMT,KAAK,YAAY,GAElFX,KAAKJ,SAASa,OAAOE,KAAK,gBAAgB,MAKzBpB,EAAE,sCACR4B,GAAG,SAAQ,eAClBG,YAAc/B,EAAEU,MAAMsB,QAAQ,YAC9BC,aAAeF,YAAYG,KAAK,YAClBH,YAAYG,KAAK,sBACnCC,QAAQlC,IAAI,gBAAkBgC,cAEtBA,kBACC,oBACA,qBACGG,SAAWL,YAAYZ,KAAK,kBAAkBc,aAAc,oBAG5DG,SAAWL,YAAYZ,KAAK,eAAec,aAAc,UAIjEI,OAASN,YAAYZ,KAAK,UAAUmB,OAGpCC,SAAS,WAENH,UACCA,SAASN,IAAI,IAGjBC,YAAYS,WAERX,YAAcE,YAAYG,KAAK,eACnCzB,KAAKJ,SAASa,OAAOC,KAAK,iBAAmBU,YAAc,MAAMT,KAAK,YAAY,IAGtFnB,IAAIG,MAAM,iBAAiBgC,SAASN,OACjCM,SAASK,OAAO,GAAqB,IAAhBL,SAASN,MAC7B5B,aAAawC,QAAQjC,KAAKH,QAAQoB,kBAAmBjB,KAAKH,QAAQmB,wBAA0BY,OAAS,IAAI5B,KAAKH,QAAQqB,OAAO,GAAGY,UAEhIA"}